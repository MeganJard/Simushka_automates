# Документация скрипта парсинга товаров на примере proficosmetics.ru
Пусть у нас есть n площадок. Парсер каждой из них представляет из себя связку единичная функция + main, который занимается сбором данных из бд, которые будем парсить. Далее все main файлы от всех площадок собираются в один большой во внешней директории

## Описание единичной функции
Скрипт предназначен для парсинга информации о товарах с сайта proficosmetics.ru. Использует Playwright для автоматизации браузера и извлечения данных о товарах, сохраняя результаты в Excel-файл.

## Зависимости
- `time` - для временных задержек
- `pandas` - для работы с данными и сохранения в Excel
- `datetime` - для работы с датами
- `re` - для обработки строк с помощью регулярных выражений
- `playwright.sync_api` - для автоматизации браузера
- `xml.etree.ElementTree` - для парсинга XML-файлов

## Глобальные переменные
- `PLOSHADKA = 'proficosmetics.ru'` - константа с названием площадки

## Функции

### `get_plosh()`
- **Описание**: Возвращает название площадки
- **Возвращает**: string - `'proficosmetics.ru'`

### `initiate_dict(page_dict)`
- **Описание**: Инициализирует словарь для хранения данных о товарах
- **Параметры**: 
  - `page_dict` (dict) - пустой словарь
- **Возвращает**: dict - словарь с пустыми списками по следующим ключам:
  - Площадка
  - Бренд
  - Артикул площадки
  - Название товара на площадке
  - Объем
  - Ссылка на товар
  - Цена
  - Цена со скидкой
  - Есть в наличии
  - Дата парсинга
  - Кол-во в наличии
  - Название товара наше

### `add_new_element(page_dict, brand, article, title, volume_1, item_block_href, price, vnal, our_name)`
- **Описание**: Добавляет данные о товаре в словарь
- **Параметры**:
  - `page_dict` (dict) - словарь для хранения данных
  - `brand` (str) - название бренда
  - `article` (str) - артикул товара
  - `title` (str) - название товара на площадке
  - `volume_1` (str) - объем товара
  - `item_block_href` (str) - ссылка на товар
  - `price` (list) - список цен [старая цена, новая цена]
  - `vnal` (bool) - наличие товара
  - `our_name` (str) - наше название товара
- **Логика**:
  - Очищает цены от символов ₽, пробелов и других лишних символов
  - Сортирует цены (большая - обычная, меньшая - со скидкой)
  - Добавляет данные в соответствующие списки словаря

### `get_brand_name(page)`
- **Описание**: Извлекает название бренда со страницы
- **Параметры**: 
  - `page` - объект страницы Playwright
- **Возвращает**: str - название бренда

### `get_article(page)`
- **Описание**: Извлекает артикул товара
- **Параметры**: 
  - `page` - объект страницы Playwright
- **Возвращает**: str - артикул после двоеточия в блоке `.kr_product_info p`

### `get_clear_name_and_vol(page)`
- **Описание**: Извлекает чистое название товара и объем
- **Параметры**: 
  - `page` - объект страницы Playwright
- **Возвращает**: tuple - (название товара без объема, объем или None)

### `get_price(page)`
- **Описание**: Извлекает старую и новую цену товара
- **Параметры**: 
  - `page` - объект страницы Playwright
- **Возвращает**: tuple - (старая цена или пустая строка, новая цена)

### `relog(page)`
- **Описание**: Выполняет авторизацию на сайте
- **Параметры**: 
  - `page` - объект страницы Playwright
- **Действия**:
  - Переходит на страницу авторизации
  - Заполняет поля логина и пароля
  - Нажимает кнопку входа

### `xml_unpack(operation_id)`
- **Описание**: Извлекает URL из XML-файла
- **Параметры**: 
  - `operation_id` (str) - идентификатор операции для поиска файла
- **Возвращает**: list - список URL из тегов `<url>` в XML

### `parse(item, operation_id)`
- **Описание**: Основная функция парсинга страницы товара
- **Параметры**: 
  - `item` (str) - наше название товара
  - `operation_id` (str/bool) - идентификатор операции или False
- **Логика**:
  - Запускает браузер Chromium в видимом режиме
  - Извлекает URL из XML (если указан operation_id)
  - Выполняет авторизацию
  - Парсит страницу товара
  - Сохраняет данные в Excel-файл
- **Вывод**: Excel-файл в папке `main_folder` с именем `gallery_[item].xlsx`

## Документация скрипта парсинга галереи товаров (gallery_parser)

### Описание
Скрипт предназначен для массового парсинга товаров с сайта `proficosmetics.ru` на основе данных из Excel-файла `YANDEX_SEARCH_RESULTS.xlsx`. Использует функцию `parse` из модуля `item_parser_playwright` для обработки каждого товара и отправляет уведомления в Telegram в случае ошибок.

### Зависимости
- `pandas` - для работы с данными из Excel
- `item_parser_playwright` - пользовательский модуль с функцией `parse`
- `sql_con` - пользовательский модуль (не используется в коде, возможно, импортирован по ошибке)
- `telebot` - для отправки сообщений в Telegram

### Глобальные переменные
- `PLOSH = 'proficosmetics.ru'` - константа с названием площадки

### Функции

#### `send_message_to_user(message)`
- **Описание**: Отправляет сообщение пользователю в Telegram
- **Параметры**: 
  - `message` (str) - текст сообщения
- **Константы**:
  - `TOKEN` (str) - токен Telegram-бота: `'7241309695:AAGblw7UNVejMafbtftgEl97lRq5zKWj2SE'`
  - `USER_ID` (str) - идентификатор пользователя: `'467688891'`
- **Логика**:
  - Создает объект бота с указанным токеном
  - Отправляет сообщение указанному пользователю

#### `gallery_parser()`
- **Описание**: Основная функция для парсинга товаров из галереи
- **Логика**:
  1. Читает данные из файла `./YANDEX_SEARCH_RESULTS.xlsx` в DataFrame
  2. Фильтрует строки, где значение столбца `plosh` равно `PLOSH` (`proficosmetics.ru`)
  3. Итерируется по отфильтрованным строкам, извлекая `Наименование` и `operation_id`
  4. Для каждого товара вызывает функцию `parse` с параметрами `Наименование` и `operation_id`
  5. Обрабатывает исключения:
     - При ошибке отправляет сообщение в Telegram с текстом `ERRRRRRRRRRROR GALLERY {ошибка}`
     - Счетчик ошибок `errors_counter` объявлен, но не используется

### Основной запуск
```python
if __name__ == '__main__':
    gallery_parser()
